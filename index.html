<!DOCTYPE html>
<html lang="lb">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>P2 â€“ Dâ€™Schoulsaachen â€“ Spiller</title>

<style>
@font-face{
  font-family:'SchoulschrÃ«ft';
  src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
  font-weight:bold;
}

:root{
  --green-light:#d8ebd4;
  --green-mid:#8cc987;
  --green-dark:#4f9c72;

  --ink:#183525;
  --white:#fff;
  --ok:#b7f0c8;
  --bad:#ffcccc;

  /* sizing tweaks */
  --border:3px;
  --radius:18px;
  --shadow:0 10px 24px rgba(0,0,0,.08);
  --pad:clamp(10px,2.2vw,16px);
}

*{box-sizing:border-box; user-select:none;}
html,body{
  margin:0; height:100%;
  font-family:'SchoulschrÃ«ft', Arial, sans-serif;
  background:linear-gradient(135deg,var(--green-light),var(--green-mid));
  color:var(--ink);
}

/* ===== top nav ===== */
.top{
  position:sticky; top:8px; z-index:10;
  display:flex; gap:10px; justify-content:center; align-items:center;
  background:#fff; border:3px solid var(--green-dark);
  border-radius:16px; padding:.28rem .7rem; margin:10px auto;
  width:fit-content;
  box-shadow:var(--shadow);
}
.iconBtn{
  font-size:1.25rem; border:3px solid var(--ink);
  background:#fff; border-radius:12px; cursor:pointer;
  padding:.2rem .55rem;
}
#flowLabel{font-size:1.05rem;}

.hidden{display:none!important;}

/* ===== sections ===== */
.wrap{
  min-height:calc(100vh - 70px);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:1.1rem;
  padding:var(--pad);
}

h1{
  margin:.2rem 0;
  font-size:clamp(1.6rem,3.8vw,2.6rem);
  text-align:center;
}

/* ===== game 1 grid: force 2 rows ===== */
.grid{
  width:min(980px,96vw);
  display:grid;
  gap:clamp(.55rem,1.6vw,1rem);
  grid-template-columns:repeat(8, minmax(0, 1fr)); /* 2 rows for 15 items */
}
@media (max-width:860px){
  .grid{grid-template-columns:repeat(6, minmax(0, 1fr));} /* becomes 3 rows on small */
}
@media (max-width:520px){
  .grid{grid-template-columns:repeat(4, minmax(0, 1fr));} /* safe on tiny screens */
}

/* token sizes slightly reduced */
.imgToken{
  background:#fff;
  border:5px solid var(--green-mid);
  border-radius:18px;
  aspect-ratio:1/1;
  display:grid;
  place-items:center;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.imgToken img{width:82%; height:82%; object-fit:contain;}

.flash-good{background:var(--ok)!important;}
.flash-bad{background:var(--bad)!important;}

.soundBtn{
  width:64px; height:48px;
  border:3px solid var(--ink);
  border-radius:14px;
  background:#fff;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.soundBtn img{width:90%; height:90%; object-fit:contain;}

/* ===== spell ===== */
.bigBox{
  width:min(40vmin,360px,85vw);
  aspect-ratio:1/1;
  border:8px solid var(--green-mid);
  border-radius:26px;
  background:#fff;
  display:grid;
  place-items:center;
  box-shadow:var(--shadow);
}
.bigBox img{width:68%; height:68%; object-fit:contain;}

.slots,.letters{
  display:flex;
  gap:.5rem;
  flex-wrap:wrap;
  justify-content:center;
  max-width:min(980px,96vw);
}

.slot{
  min-width:2.6rem;
  min-height:3.2rem;
  border-bottom:5px solid var(--ink);
  font-size:2rem;
  display:grid;
  place-items:center;
  cursor:pointer; /* clickable removal */
}
.letter{
  border:3px solid var(--ink);
  border-radius:12px;
  padding:.25rem .55rem;
  font-size:1.9rem;
  cursor:pointer;
  background:#fff;
  box-shadow:var(--shadow);
}

.btn{
  border:3px solid var(--ink);
  background:#fff;
  border-radius:14px;
  padding:.4rem .85rem;
  cursor:pointer;
  font-family:'SchoulschrÃ«ft';
  font-size:1.05rem;
  box-shadow:var(--shadow);
}

/* ===== memory (proper) ===== */
.memGrid{
  width:min(980px,96vw);
  display:grid;
  gap:clamp(.6rem,1.8vw,1rem);
  grid-template-columns:repeat(4, minmax(0, 1fr));
}
@media (max-width:780px){ .memGrid{grid-template-columns:repeat(3,1fr);} }
@media (max-width:520px){ .memGrid{grid-template-columns:repeat(2,1fr);} }

.card{
  aspect-ratio:5/3;
  perspective:1000px;
  cursor:pointer;
}
.inner{
  position:relative;
  width:100%;
  height:100%;
  transition:.28s;
  transform-style:preserve-3d;
}
.flipped .inner{transform:rotateY(180deg);}
.face{
  position:absolute; inset:0;
  border-radius:16px;
  border:5px solid var(--green-mid);
  background:#fff;
  display:grid;
  place-items:center;
  backface-visibility:hidden;
  box-shadow:var(--shadow);
}
.front{
  background:#fff url('https://i.postimg.cc/gnrf0LLw/cardback-p2.png') center/68% no-repeat;
}
.back{transform:rotateY(180deg);}
.memWord{font-size:1.6rem; text-align:center; padding:.4rem;}

/* ===== sort (drag + tap fallback) ===== */
.sortLayout{
  width:min(980px,96vw);
  display:grid;
  grid-template-columns:repeat(3, minmax(0, 1fr));
  gap:.8rem;
}
@media (max-width:820px){ .sortLayout{grid-template-columns:1fr; max-width:560px;} }

.dropCol{
  background:#fff;
  border:8px solid var(--green-mid);
  border-radius:22px;
  padding:.7rem;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.6rem;
  min-height:230px;
  box-shadow:var(--shadow);
}
.dropCol img{max-width:140px; height:auto;}
.dropInner{
  width:100%;
  display:flex;
  flex-wrap:wrap;
  gap:.45rem;
  justify-content:center;
  padding-bottom:.4rem;
}

.sortPool{
  margin-top:.8rem;
  display:flex;
  flex-wrap:wrap;
  gap:.55rem;
  justify-content:center;
  max-width:min(980px,96vw);
}
.sortItem{
  width:64px; height:64px;
  border:4px solid var(--green-mid);
  border-radius:16px;
  background:#fff;
  cursor:grab;
  display:grid;
  place-items:center;
  box-shadow:var(--shadow);
}
.sortItem:active{cursor:grabbing;}
.sortItem img{width:84%; height:84%; object-fit:contain;}

.pulseOk{outline:4px solid var(--ok); outline-offset:2px;}
.pulseBad{outline:4px solid var(--bad); outline-offset:2px;}
</style>
</head>

<body>

<div class="top">
  <button class="iconBtn" id="prev" aria-label="virdrun">â—€</button>
  <span id="flowLabel">1. Spill</span>
  <button class="iconBtn" id="next" aria-label="nÃ¤chst">â–¶</button>
</div>

<!-- GAME 1 -->
<section class="wrap" id="g1">
  <h1>Lauschter a klick</h1>
  <div class="grid" id="grid1"></div>
  <button class="soundBtn" id="play1" aria-label="lauschter">
    <img src="https://i.postimg.cc/ZqG1TRbC/lauschter-p2.png" alt="">
  </button>
</section>

<!-- GAME 2 (MEMORY second, as required) -->
<section class="wrap hidden" id="g2">
  <h1>Memory</h1>
  <div class="memGrid" id="memGrid"></div>
  <button class="btn" id="memReset">â†» Reset</button>
</section>

<!-- GAME 3 -->
<section class="wrap hidden" id="g3">
  <h1>Schreif dâ€™Wuert</h1>
  <div class="bigBox"><img id="spellImg" alt=""></div>
  <div class="slots" id="spellSlots"></div>
  <div class="letters" id="spellLetters"></div>
  <div style="display:flex; gap:.8rem; flex-wrap:wrap; justify-content:center;">
    <button class="btn" id="spellReset">â†» Reset</button>
    <button class="btn" id="spellHear">ðŸ”Š Lauschter</button>
    <button class="btn" id="spellNext">Weider</button>
  </div>
</section>

<!-- GAME 4 -->
<section class="wrap hidden" id="g4">
  <h1>SortÃ©ier no Genre</h1>

  <div class="sortLayout">
    <div class="dropCol" data-cat="masc">
      <img src="https://i.postimg.cc/MvXhGffV/mannlech.png" alt="">
      <div class="dropInner"></div>
    </div>
    <div class="dropCol" data-cat="fem">
      <img src="https://i.postimg.cc/7fbpLJJz/weiblech.png" alt="">
      <div class="dropInner"></div>
    </div>
    <div class="dropCol" data-cat="neut">
      <img src="https://i.postimg.cc/3dWPw00g/sachlech.png" alt="">
      <div class="dropInner"></div>
    </div>
  </div>

  <div class="sortPool" id="sortPool"></div>
  <button class="btn" id="sortReset">â†» Reset</button>
</section>

<audio id="speaker"></audio>

<script>
/* ================= DATA ================= */
const AUDIO="https://github.com/albrechtclaire1007/p2hausdeieren/raw/refs/heads/main/";

const ITEMS=[
 {id:'deckelsmouk',word:"Deckelsmouk",img:'https://i.postimg.cc/DmMNrkKY/deckelsmouk.png',audio:'p2_deckelsmouk.mp3',g:'masc'},
 {id:'fesch',word:"FÃ«sch",img:'https://i.postimg.cc/bGgCd4T9/fesch.png',audio:'p2_fesch.mp3',g:'masc'},
 {id:'goldfesch',word:"GoldfÃ«sch",img:'https://i.postimg.cc/sBm61bcg/goldfesch.png',audio:'p2_goldfesch.mp3',g:'masc'},
 {id:'hamster',word:"Hamster",img:'https://i.postimg.cc/62QHZzjv/hamster.png',audio:'p2_hamster.mp3',g:'masc'},
 {id:'hond',word:"Hond",img:'https://i.postimg.cc/XZ41jnwX/hond.png',audio:'p2_hond.mp3',g:'masc'},
 {id:'kanengchen',word:"KanÃ©ngchen",img:'https://i.postimg.cc/gwsSr1DK/kanengchen.png',audio:'p2_kanengchen.mp3',g:'neut'},
 {id:'kaz',word:"Kaz",img:'https://i.postimg.cc/9Rfx918s/kaz.png',audio:'p2_kaz.mp3',g:'fem'},
 {id:'maus',word:"Maus",img:'https://i.postimg.cc/qhZ1xnWv/maus.png',audio:'p2_maus.mp3',g:'fem'},
 {id:'papagei',word:"Papagei",img:'https://i.postimg.cc/R6bgLf2r/papagei.png',audio:'p2_papagei.mp3',g:'masc'},
 {id:'vullchen',word:"Villchen",img:'https://i.postimg.cc/hQzpyvqJ/villchen.png',audio:'p2_villchen.mp3',g:'neut'}
];

/* ================= HELPERS ================= */
const speaker=document.getElementById('speaker');
function play(a){ speaker.src=AUDIO+a; speaker.play(); }
function shuffle(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function flash(el, ok=true){
  el.classList.remove('pulseOk','pulseBad');
  el.classList.add(ok?'pulseOk':'pulseBad');
  setTimeout(()=>el.classList.remove('pulseOk','pulseBad'),450);
}

/* ================= NAV ================= */
const pages=['g1','g2','g3','g4'];
let p=0;
document.getElementById('prev').onclick=()=>show(p-1);
document.getElementById('next').onclick=()=>show(p+1);
function show(i){
  p=Math.max(0,Math.min(pages.length-1,i));
  pages.forEach((id,n)=>document.getElementById(id).classList.toggle('hidden',n!==p));
  document.getElementById('flowLabel').textContent=(p+1)+'. Spill';
}
show(0);

/* ================= GAME 1: listen + click ================= */
const grid=document.getElementById('grid1');
let bag1=[], target1=null;

function initG1(){
  grid.innerHTML='';
  bag1=shuffle(ITEMS);
  ITEMS.forEach(it=>{
    const b=document.createElement('div');
    b.className='imgToken';
    b.innerHTML=`<img src="${it.img}" alt="">`;
    b.onclick=()=>{
      if(!target1) return;
      if(it.id===target1.id){
        b.classList.add('flash-good');
        setTimeout(()=>b.classList.remove('flash-good'),450);
        nextG1();
      }else{
        b.classList.add('flash-bad');
        setTimeout(()=>b.classList.remove('flash-bad'),450);
      }
    };
    grid.appendChild(b);
  });
  nextG1();
}
function nextG1(){
  if(bag1.length===0) bag1=shuffle(ITEMS);
  target1=bag1.pop();
  play(target1.audio);
}
document.getElementById('play1').onclick=()=>target1 && play(target1.audio);
initG1();

/* ================= GAME 2: MEMORY proper ================= */
const memGrid=document.getElementById('memGrid');
const memReset=document.getElementById('memReset');
let memFirst=null, memLock=false, memMatched=0, memDeck=[];

function buildMemory(){
  memGrid.innerHTML='';
  memFirst=null; memLock=false; memMatched=0;

  const base=shuffle(ITEMS).slice(0,8); // 8 pairs = 16 cards
  memDeck=shuffle(base.flatMap(it=>[
    {key:it.id, type:'img', it},
    {key:it.id, type:'word', it}
  ]));

  memDeck.forEach((c,idx)=>{
    const card=document.createElement('div');
    card.className='card';
    card.dataset.key=c.key;
    card.dataset.type=c.type;
    card.dataset.idx=idx;

    const backContent = (c.type==='img')
      ? `<img src="${c.it.img}" style="width:78%;height:78%;object-fit:contain" alt="">`
      : `<div class="memWord">${c.it.word}</div>`;

    card.innerHTML=`
      <div class="inner">
        <div class="face front"></div>
        <div class="face back">${backContent}</div>
      </div>
    `;

    card.onclick=()=>flipCard(card,c);
    memGrid.appendChild(card);
  });
}

function flipCard(card,c){
  if(memLock) return;
  if(card.classList.contains('matched')) return;
  if(card.classList.contains('flipped')) return;

  card.classList.add('flipped');

  // optional: only play audio when revealing word side (feels nice)
  if(c.type==='word') play(c.it.audio);

  if(!memFirst){
    memFirst={card,c};
    return;
  }

  // second card
  memLock=true;
  const a=memFirst; const b={card,c};

  const isMatch = a.c.key===b.c.key && a.c.type!==b.c.type;
  if(isMatch){
    a.card.classList.add('matched');
    b.card.classList.add('matched');
    memMatched++;
    memFirst=null;
    memLock=false;

    // if finished, rebuild after a moment
    if(memMatched===8){
      setTimeout(buildMemory,700);
    }
  }else{
    setTimeout(()=>{
      a.card.classList.remove('flipped');
      b.card.classList.remove('flipped');
      memFirst=null;
      memLock=false;
    },650);
  }
}
memReset.onclick=buildMemory;
buildMemory();

/* ================= GAME 3: SPELL (click place + click remove) ================= */
let spellBag=[], cur=null;
const slots=document.getElementById('spellSlots');
const letters=document.getElementById('spellLetters');
const img=document.getElementById('spellImg');

function initSpellBag(){
  spellBag=shuffle(ITEMS);
}

function buildSpell(){
  if(spellBag.length===0) initSpellBag();
  cur=spellBag.pop();

  img.src=cur.img;

  // build empty slots
  slots.innerHTML='';
  letters.innerHTML='';

  const chars=[...cur.word];

  chars.forEach((_,i)=>{
    const s=document.createElement('div');
    s.className='slot';
    s.dataset.i=i;
    s.onclick=()=>{
      // click-to-remove: put letter back to pool
      if(!s.textContent) return;
      const ch=s.textContent;
      s.textContent='';
      const l=document.createElement('div');
      l.className='letter';
      l.textContent=ch;
      l.onclick=()=>placeLetter(l);
      letters.appendChild(l);
    };
    slots.appendChild(s);
  });

  // letters pool
  shuffle(chars).forEach(ch=>{
    const l=document.createElement('div');
    l.className='letter';
    l.textContent=ch;
    l.onclick=()=>placeLetter(l);
    letters.appendChild(l);
  });
}

function placeLetter(letterEl){
  const empty=[...slots.children].find(s=>!s.textContent);
  if(!empty) return;
  empty.textContent=letterEl.textContent;
  letterEl.remove();
  checkSpell();
}

function checkSpell(){
  const built=[...slots.children].map(s=>s.textContent).join('');
  if(built.length!==cur.word.length) return;
  if(built===cur.word){
    setTimeout(buildSpell,550);
  }else{
    // quick feedback: flash slots
    slots.classList.add('pulseBad');
    setTimeout(()=>slots.classList.remove('pulseBad'),300);
  }
}

document.getElementById('spellHear').onclick=()=>cur && play(cur.audio);
document.getElementById('spellNext').onclick=buildSpell;
document.getElementById('spellReset').onclick=buildSpell;

initSpellBag();
buildSpell();

/* ================= GAME 4: SORT (drag+drop + tap fallback) ================= */
const pool=document.getElementById('sortPool');
const sortReset=document.getElementById('sortReset');

let selectedSort=null;

function buildSort(){
  // clear columns + pool
  document.querySelectorAll('.dropInner').forEach(d=>d.innerHTML='');
  pool.innerHTML='';
  selectedSort=null;

  ITEMS.forEach(it=>{
    const b=document.createElement('div');
    b.className='sortItem';
    b.draggable=true;
    b.dataset.g=it.g;
    b.dataset.id=it.id;
    b.innerHTML=`<img src="${it.img}" alt="">`;

    // drag start
    b.addEventListener('dragstart',(e)=>{
      e.dataTransfer.setData('text/plain', it.id);
      e.dataTransfer.setData('cat', it.g);
      selectedSort=b; // also store
    });

    // tap fallback: first tap selects, second tap on column drops
    b.onclick=()=>{
      if(selectedSort===b){
        selectedSort=null;
        flash(b,true);
      }else{
        selectedSort=b;
        flash(b,true);
      }
    };

    pool.appendChild(b);
  });
}

document.querySelectorAll('.dropCol').forEach(col=>{
  // allow drop
  col.addEventListener('dragover',(e)=>e.preventDefault());
  col.addEventListener('drop',(e)=>{
    e.preventDefault();
    const id=e.dataTransfer.getData('text/plain');
    const cat=e.dataTransfer.getData('cat');
    const want=col.dataset.cat;
    const itemEl=[...document.querySelectorAll('.sortItem')].find(x=>x.dataset.id===id);
    if(!itemEl) return;

    if(cat===want){
      col.querySelector('.dropInner').appendChild(itemEl);
      flash(col,true);
    }else{
      flash(col,false);
      flash(itemEl,false);
    }
  });

  // tap-drop fallback
  col.onclick=()=>{
    if(!selectedSort) return;
    const want=col.dataset.cat;
    const cat=selectedSort.dataset.g;
    if(cat===want){
      col.querySelector('.dropInner').appendChild(selectedSort);
      flash(col,true);
      selectedSort=null;
    }else{
      flash(col,false);
      flash(selectedSort,false);
    }
  };
});

sortReset.onclick=buildSort;
buildSort();
</script>

</body>
</html>
